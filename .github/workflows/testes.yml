
name: Execução de Testes

on:
  workflow_call:

jobs:
  unit_test:
      name: teste de Unidade
      runs-on: ubuntu-latest
      steps:
        - name: Obtendo o código do projeto
          uses: actions/checkout@v4
        - name: Setup dotnet
          uses: actions/setup-dotnet@v4
          with:
            dotnet-version: "8.0.300"
        - name: Execução do teste de Unidade
          working-directory: ./src
          run: dotnet test ./Review-Filmes.Test.Unit/Review-Filmes.Test.Unit.csproj

  integration-test:
      name: Teste de Integração
      runs-on: ubuntu-latest
      services:
        postgre:
          image: postgres:latest
          ports:
            - 5432:5432
          env:
              POSTGRES_USER: review
              POSTGRES_PASSWORD: postgrespwd
              POSTGRES_DB: review-filmes
      steps:
        - name: Obtendo o código do projeto
          uses: actions/checkout@v4

        - name: Setup dotnet
          uses: actions/setup-dotnet@v4
          with:
            dotnet-version: "8.0.300"
  
  Sonarqube:
      name: Scan com o Sonarqube
      runs-on: ubuntu-latest
      steps:
        - name: Obtendo o código do projeto
          uses: actions/checkout@v4

        - name: Setup JDK
          uses: actions/setup-java@v4
          with:
            distribution: adopt
            java-version: '21'
            ## configurar servidor de sonaqube
            ## criar projeto de intgração

        - name: Setup dotnet
          uses: actions/setup-dotnet@v4
          with:
            dotnet-version: "8.0.300"
